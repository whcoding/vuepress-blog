(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{334:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"理解docker0网卡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理解docker0网卡"}},[s._v("#")]),s._v(" 理解Docker0网卡")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images.whcoding.com/29684-tr2gsst6iqp.png",alt:"29684-tr2gsst6iqp.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("问题: docker 是如何处理容器网络访问的?")])]),s._v(" "),a("ul",[a("li",[s._v("我们通过命令查看某一个容器的内部ip 可以看出容器内部的ip和docker0网卡是在同一网段的")]),s._v(" "),a("li",[s._v("并且宿主机和容器之间是可以相互ping通的")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it tomcat1 ip addr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images.whcoding.com/77598-5q4381v46rc.png",alt:"77598-5q4381v46rc.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("原理")])]),s._v(" "),a("ul",[a("li",[s._v("每启动一个容器, docker就会给容器分配一个ip. 只要安装了docker 就会有一个docker0的网卡")]),s._v(" "),a("li",[s._v("docker0的网卡和真实的物理网卡之间是桥接模式")]),s._v(" "),a("li",[s._v("使用的技术是 evth-pair技术")])]),s._v(" "),a("h3",{attrs:{id:"evth-pair-技术"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#evth-pair-技术"}},[s._v("#")]),s._v(" evth-pair 技术")]),s._v(" "),a("ul",[a("li",[s._v("当我们启动容器的时候就会生成一对网卡")]),s._v(" "),a("li",[s._v("evth-pair 就是一对虚拟设备接口, 他们都是成对出现的 一段连着协议, 一段彼此相连")]),s._v(" "),a("li",[s._v("有了这种特性 evth-pair 充当一个桥梁,连接各种虚拟设备")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images.whcoding.com/24034-yds8lzhwgkq.png",alt:"24034-yds8lzhwgkq.png"}}),s._v(" "),a("img",{attrs:{src:"https://images.whcoding.com/06812-rqz8sfmlcps.png",alt:"06812-rqz8sfmlcps.png"}})]),s._v(" "),a("h4",{attrs:{id:"画图理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#画图理解"}},[s._v("#")]),s._v(" 画图理解")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images.whcoding.com/75492-to9cuhy2v9.png",alt:"75492-to9cuhy2v9.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("结论")])]),s._v(" "),a("ul",[a("li",[s._v("tomcat01 和 tomcat02 是公用一个路由器 docker0")]),s._v(" "),a("li",[s._v("容器在不指定网络的情况下, 都是走docker0 路由的 docker会给容器分配一个默认的ip")]),s._v(" "),a("li",[s._v("Docker中所有的网络接口都是虚拟的\n"),a("img",{attrs:{src:"https://images.whcoding.com/93211-0tos63kx77z.png",alt:"93211-0tos63kx77z.png"}})])]),s._v(" "),a("h3",{attrs:{id:"容器互联-link"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器互联-link"}},[s._v("#")]),s._v(" 容器互联 --link")]),s._v(" "),a("ul",[a("li",[s._v("通过上面我们会发现容器之间可以通过ip地址是可以ping通的")]),s._v(" "),a("li",[s._v("那么再某些情况下不用ip 我们可不可以用容器名的方式 ping通?")]),s._v(" "),a("li",[s._v("可以使用 --link 来解决上面的问题")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 我们重新启动一个tomcat 并且 --link tomcat1\ndocker run -d -P --link tomcat tomcat\n\n# 完成之后我们就可以ping通了\ndocker exec -it jovial_chebyshev ping tomcat1\n\nPING tomcat1 (172.17.0.4) 56(84) bytes of data.\n64 bytes from tomcat1 (172.17.0.4): icmp_seq=1 ttl=64 time=0.069 ms\n64 bytes from tomcat1 (172.17.0.4): icmp_seq=2 ttl=64 time=0.060 ms\n64 bytes from tomcat1 (172.17.0.4): icmp_seq=4 ttl=64 time=0.069 ms\n--- tomcat1 ping statistics ---\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[s._v("这样做有一个弊端就是 反向 ping 是不通的")]),s._v(" "),a("li",[s._v("原理就是在 jovial_chebyshev 容器中的 /etc/host 中有写")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it jovial_chebyshev cat /etc/hosts\n127.0.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nff00::0\tip6-mcastprefix\nff02::1\tip6-allnodes\nff02::2\tip6-allrouters\n172.17.0.4\ttomcat1 612aeb07e2e7\n172.17.0.2\te7613df5b961\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("--link 就是在我们 hosts 中增加了一条虚拟域名")])]),s._v(" "),a("h3",{attrs:{id:"自定义网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义网络"}},[s._v("#")]),s._v(" 自定义网络")]),s._v(" "),a("h4",{attrs:{id:"查看所有的docker网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看所有的docker网络"}},[s._v("#")]),s._v(" 查看所有的docker网络")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nea834618e218        bridge              bridge              local\n2da75ecdb782        host                host                local\nd7c3fa26b1bd        none                null                local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络模式"}},[s._v("#")]),s._v(" 网络模式")]),s._v(" "),a("ul",[a("li",[s._v("bridge : 桥接模式(docker默认)")]),s._v(" "),a("li",[s._v("none : 不配置网络")]),s._v(" "),a("li",[s._v("host : 和宿主机共享网络")]),s._v(" "),a("li",[s._v("container : 容器网络连通(用的少, 局限很大)")])]),s._v(" "),a("h4",{attrs:{id:"创建自定义网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建自定义网络"}},[s._v("#")]),s._v(" 创建自定义网络")]),s._v(" "),a("ul",[a("li",[s._v("--subnet 子网")]),s._v(" "),a("li",[s._v("--gateway 网关")]),s._v(" "),a("li",[s._v("--driver 默认桥接模式 不写也可以")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"查看自己创建的网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看自己创建的网络"}},[s._v("#")]),s._v(" 查看自己创建的网络")]),s._v(" "),a("ul",[a("li",[s._v("命令: docker network inspect mynet")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[\n    {\n        "Name": "mynet",\n        "Id": "6eb44c49b01928fd5c010c72c2738980814855e372a215eac422d35bdb1c70c4",\n        "Created": "2020-09-22T05:58:08.319032125Z",\n        "Scope": "local",\n        "Driver": "bridge",\n        "EnableIPv6": false,\n        "IPAM": {\n            "Driver": "default",\n            "Options": {},\n            "Config": [\n                {\n                    "Subnet": "192.168.0.0/16",\n                    "Gateway": "192.168.0.1"\n                }\n            ]\n        },\n        "Internal": false,\n        "Attachable": false,\n        "Ingress": false,\n        "ConfigFrom": {\n            "Network": ""\n        },\n        "ConfigOnly": false,\n        "Containers": {},\n        "Options": {},\n        "Labels": {}\n    }\n]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h4",{attrs:{id:"使用自己创建的网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用自己创建的网络"}},[s._v("#")]),s._v(" 使用自己创建的网络")]),s._v(" "),a("ul",[a("li",[s._v("--net")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker run -d -P --net mynet --name tomcat-net-01 tomcat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"再次测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#再次测试"}},[s._v("#")]),s._v(" 再次测试")]),s._v(" "),a("ul",[a("li",[s._v("使用自己的网络创建两个容器并且相互ping 都是可以ping通的")]),s._v(" "),a("li",[s._v("比之前的 --link 要好很多")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it tomcat-net-01 ping tomcat-net-02\nPING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.\n64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.073 ms\n64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.063 ms\n64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.063 ms\n\n#反向ping 也是可以的\nPING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.\n64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.100 ms\n64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.078 ms\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"网络连通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络连通"}},[s._v("#")]),s._v(" 网络连通")]),s._v(" "),a("h4",{attrs:{id:"容器在不同的网段内如何实现互通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器在不同的网段内如何实现互通"}},[s._v("#")]),s._v(" 容器在不同的网段内如何实现互通?")]),s._v(" "),a("blockquote",[a("p",[s._v("示意图")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images.whcoding.com/13263-x84wd8oss4.png",alt:"13263-x84wd8oss4.png"}})]),s._v(" "),a("ul",[a("li",[s._v("我们会发现不同网段的容器不能ping通的.")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it tomcat01 ping tomcat-net-01\nping: tomcat-net-01: Name or service not known\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("所以需要使用 --network connect 命令")])]),s._v(" "),a("h4",{attrs:{id:"连通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连通"}},[s._v("#")]),s._v(" 连通")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker network connect mynet tomcat01\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[s._v("#")]),s._v(" 查看")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('docker network inspect mynet\n\n[\n    {\n        "Name": "mynet",\n        .....\n        .....\n        ...\n        "Containers": {\n            "0796e3b7250d5c49372183e28266de528dfe072bb884220aeff9f0ccab4521a7": {\n                "Name": "tomcat-net-01",\n                "EndpointID": "e53cde49134bf3fb72f9bcd801ac73e208705b8cae416b689a726511b1125d49",\n                "MacAddress": "02:42:c0:a8:00:02",\n                "IPv4Address": "192.168.0.2/16",\n                "IPv6Address": ""\n            },\n            "2a187f1b05a15d33c5cc382c2b84d0b93fa4748f3e2ce4daed0ca0bc7a4d0500": {\n                "Name": "tomcat01",\n                "EndpointID": "652193a8312425944682a4b48f2f1a1d35ec5e4cea6806fbe0d5be11380627e8",\n                "MacAddress": "02:42:c0:a8:00:04",\n                "IPv4Address": "192.168.0.4/16",\n                "IPv6Address": ""\n            },\n           .....\n        },\n        "Options": {},\n        "Labels": {}\n    }\n]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("ul",[a("li",[s._v("连通之后我们可以看到 tomcat01 容器直接放到了 mynet的网络下")]),s._v(" "),a("li",[s._v("这就是一个容器两个ip地址")]),s._v(" "),a("li",[s._v("这样我们就可以ping通了")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it tomcat01 ping tomcat-net-01\n\nPING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.\n64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.082 ms\n64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.074 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);